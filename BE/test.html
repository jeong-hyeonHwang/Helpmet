<!DOCTYPE html>
<html>
<head>
  <title>자전거 경로 시각화</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map { height: 100vh; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    const fromLat = 37.5665;
    const fromLon = 126.9780;
    const toLat = 37.5700;
    const toLon = 126.9820;

    fetch(`http://127.0.0.1:8000/route?from_lat=${fromLat}&from_lon=${fromLon}&to_lat=${toLat}&to_lon=${toLon}`)
      .then(response => response.json())
      .then(data => {
        const route = data.route;
        const instructions = data.instructions || [];
        const start = route[0].from;
        const end = route.at(-1).to;

        const map = L.map('map').setView([start.lat, start.lon], 17);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 20
        }).addTo(map);

        // ✅ 경로 표시 + 팝업: cycleway_type
        route.forEach((segment, idx) => {
          const latlngs = [
            [segment.from.lat, segment.from.lon],
            [segment.to.lat, segment.to.lon]
          ];
          const color = segment.is_cycleway ? 'blue' : 'gray';
          const cycleType = segment.cycleway_type || '없음';

          const poly = L.polyline(latlngs, {
            color: color,
            weight: 5,
            opacity: 0.9
          }).addTo(map);

          poly.bindPopup(`Cycleway Type: ${cycleType}`);
        });

        // ✅ 안내 메시지 마커
        instructions.forEach(ins => {
          const { lat, lon } = ins.location;
          const msg = ins.message;
          const marker = L.marker([lat, lon]).addTo(map);
          marker.bindPopup(`🧭 ${msg}`);
        });

        // ✅ 출발/도착 마커
        L.marker([start.lat, start.lon]).addTo(map).bindPopup("출발지").openPopup();
        L.marker([end.lat, end.lon]).addTo(map).bindPopup("도착지");
      })
      .catch(error => {
        console.error("API 요청 중 오류:", error);
        alert("경로 데이터를 불러오지 못했습니다.");
      });
  </script>
</body>
</html>
